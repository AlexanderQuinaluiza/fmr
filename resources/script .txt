ALTER TABLE DESCUENTOS
DROP  foreign key FK_TIENE_DESCUENTO;

ALTER TABLE DESCUENTOS
DROP COLUMN ID_PRO;

create TABLE DETALLES_DESCUENTOS(
ID_PRO BIGINT(20) NOT NULL,
ID_DESC BIGINT NOT NULL,
CONSTRAINT FK_PROD_DET_DESC FOREIGN KEY (ID_PRO) REFERENCES PRODUCTOS(ID_PRO),
CONSTRAINT FK_DESC_DET_DESC FOREIGN KEY (ID_DESC) REFERENCES DESCUENTOS(ID_DESC)
) ENGINE InnoDB;


CREATE DEFINER=`root`@`localhost` PROCEDURE `pGetDescuentoByProducto`(IN `idproducto` INT)
NO SQL
begin
SELECT d.PORCENTAJE_DESC from DESCUENTOS as d,
PRODUCTOS as p ,DETALLES_DESCUENTOS as dt WHERE p.ID_PRO = dt.ID_PRO AND
p.ID_PRO = idproducto AND
CURRENT_DATE <= cast(d.FECHA_FIN_DESC as date)
AND d.ESTADO_DESC=1
and dt.ID_DESC=d.ID_DESC
limit 1;
END
